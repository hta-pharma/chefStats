<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="chefStats">
<title>Adding new functions • chefStats</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Adding new functions">
<meta property="og:description" content="chefStats">
<meta property="og:image" content="https://hta-pharma.github.io/chefStats/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">chefStats</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/chefStats.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/add_functions.html">Adding new functions</a>
    <a class="dropdown-item" href="../articles/function_types.html">Function types</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="add_functions_files/kePrint-0.0.1/kePrint.js"></script><link href="add_functions_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Adding new functions</h1>
            
      
      
      <div class="d-none name"><code>add_functions.Rmd</code></div>
    </div>

    
    
<p>To add new functions to chefStats, you follow three general
steps:</p>
<ol style="list-style-type: decimal">
<li>Consider what type of function you need:
<code>stat_by_strata_by_trt</code>,
<code>stat_by_strata_across_trt</code> or
<code>stat_across_strata_across_trt</code> (see article <a href="https://hta-pharma.github.io/chefStats/articles/function_types.html">Function
types</a>.</li>
<li>Decide what information the function needs in order to compute the
desired results. See section <a href="#interface-with-chef">Interface
with chef</a>
</li>
<li>Write the function definition (use <code><a href="../reference/use_chefStats.html">use_chefStats()</a></code> to
help create the template)</li>
<li>Write the appropriate unit-tests for the function (using <a href="https://testthat.r-lib.org/" class="external-link">testthat</a> framework) <br>
</li>
</ol>
<div class="section level3">
<h3 id="walk-through-example">Walk through example<a class="anchor" aria-label="anchor" href="#walk-through-example"></a>
</h3>
<p>Here we show how we would add the function
<code><a href="../reference/n_subj_event.html">n_subj_event()</a></code>, which counts the number of subjects
experiencing the event by stratification level and treatment level, if
it didn’t already exist in chefStats.</p>
<ol style="list-style-type: decimal">
<li>Since the function produces a number by stratification level and by
treatment level, this will be a <code>stat_by_strata_by_trt</code>
</li>
<li>The function will need to know (see section <a href="#interface-with-chef">Interface with chef</a> for more details on
how to pass this information from chef to chefStats):
<ul>
<li>Who was eligible to have the event</li>
<li>Who has the event</li>
<li>What the stratification “group” (e.g. SEX, AGE, etc) and level
(“MALE”, “&gt;65”, etc). is</li>
<li>What the treatment level is (e.g. “TreatmentA”)</li>
</ul>
</li>
<li>The function definition might look like this:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">n_subj_event</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>,</span>
<span>           <span class="va">event_index</span>,</span>
<span>           <span class="va">cell_index</span>,</span>
<span>           <span class="va">subjectid_var</span>,</span>
<span>           <span class="va">...</span> <span class="co"># the `...` are required for all chefStats functions to "collect" any unused arguments passed from chef</span></span>
<span>           <span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Please see the "Interface with chef" section for details on what</span></span>
<span>    <span class="co"># `event_index` and `cell_index`</span></span>
<span>    </span>
<span>    <span class="co"># `intersect()` provides us with a vector of rows in `dat` that match both</span></span>
<span>    <span class="co"># `event_index` and `cell_index` - aka records that were BOTH eligible to</span></span>
<span>    <span class="co"># have the event (`cell_index`) AND had the event (`event_index`)</span></span>
<span>    <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">event_index</span>, <span class="va">cell_index</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Return all matching rows in `dat` where `INDEX_`</span></span>
<span>    <span class="co"># matches `index`.</span></span>
<span>    <span class="va">event_rows</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="va">INDEX_</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">index</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="co"># `dat` contains event data, meaning subjects can appear more than once if</span></span>
<span>    <span class="co"># they have &gt;1 event, so we need to remove these extra rows to get a proper</span></span>
<span>    <span class="co"># count</span></span>
<span>    <span class="va">event_rows_unique_by_subject</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">event_rows</span>, by <span class="op">=</span> <span class="va">subjectid_var</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">stat</span> <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">event_rows_unique_by_subject</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># The return object has to be a data.table object with the following 3</span></span>
<span>    <span class="co"># columns. The `value` column always has to be a double (not an integer)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span></span>
<span>      <span class="fu">data.table</span><span class="op">(</span></span>
<span>        description <span class="op">=</span> <span class="st">"Number of subjects with events"</span>,</span>
<span>        label <span class="op">=</span> <span class="st">"n_subj_events"</span>,</span>
<span>        value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="va">stat</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<style>
/* Remove border around tab content */
.tab-content {
    border: none !important;
}
</style>
<p><br></p>
</div>
<div class="section level3 tabset tabset-pills">
<h3 class="tabset tabset-pills" id="interface-with-chef">Interface with chef<a class="anchor" aria-label="anchor" href="#interface-with-chef"></a>
</h3>
<p>The statistical functions from chefStats will be called within the
context of a chef pipeline. The category of the function determines what
arguments are passed from chef to the function, however some arguments
are passed to all categories.</p>
<p>The following table describes arguments that are passed to
<strong>all</strong> chefStats function:</p>
<table class="table table table-bordered table table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Arguments always passed to chefStats functions
</caption>
<thead><tr>
<th style="text-align:left;background-color: lightblue !important;">
Argument Names
</th>
<th style="text-align:left;background-color: lightblue !important;">
Description
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>dat</code>
</td>
<td style="text-align:left;">
A <code>data.table</code> containing the analysis data set produced by
the <code>prepare_data</code> function. To allow flexability for
creative use of chefStats functions, this dataset is
<strong>not</strong> filtered to the exact records needed for each
analysis when passed to chefStats. Instead this filtering is done inside
the chefStats functions. This is done using the <code>INDEX_</code>
column from <code>dat</code> that serves as a row ID, and is used for
filtering with, for example, <code>cell_index</code> or
<code>event_index</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>event_index</code>
</td>
<td style="text-align:left;">
A <code>vector</code> of indicies indicating which rows (as specified in
<code>INDEX_</code> column of <code>dat</code>) are considered to be
events for the endpoint specification under evaluation
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>strata_var</code>
</td>
<td style="text-align:left;">
A <code>character</code> indicating which stratatification is being used
(e.g. SEX, AGE, etc)
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>treatment_var</code>
</td>
<td style="text-align:left;">
A <code>character</code> indicating the name of the column in
<code>dat</code> containing the treatment information used for the
endpoint
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>subjectid_var</code>
</td>
<td style="text-align:left;">
A <code>character</code> specifying the name of the column in
<code>dat</code> containing the subject ID. Defaults to “USUBJID”
</td>
</tr>
</tbody>
</table>
<p><br><br></p>
<p>Additionally, each function type receives the following arguments</p>



<ul class="nav nav-pills" id="interface-with-chef" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#stat_by_strata_by_trt" id="stat_by_strata_by_trt-tab" type="button" role="tab" aria-controls="stat_by_strata_by_trt" aria-selected="true" class="active nav-link">stat_by_strata_by_trt</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#stat_by_strata_across_trt" id="stat_by_strata_across_trt-tab" type="button" role="tab" aria-controls="stat_by_strata_across_trt" aria-selected="false" class="nav-link">stat_by_strata_across_trt</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#stat_by_strata_across_trt-1" id="stat_by_strata_across_trt-1-tab" type="button" role="tab" aria-controls="stat_by_strata_across_trt-1" aria-selected="false" class="nav-link">stat_by_strata_across_trt</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="stat_by_strata_by_trt" role="tabpanel" aria-labelledby="stat_by_strata_by_trt-tab">

<table class="table table table-bordered table table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Additional arguments passed to by_strata_by_trt functions
</caption>
<thead><tr>
<th style="text-align:left;background-color: lightblue !important;">
Argument Names
</th>
<th style="text-align:left;background-color: lightblue !important;">
Description
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>cell_index</code>
</td>
<td style="text-align:left;">
A <code>vector</code> of indicies specifying which rows in
<code>dat</code> are considered to be part of the analysis for the given
strata level and treatment level under evaluation. For example, if the
current instance of the function was analysis “Number of Events” for
SEX==“M” and TRT01A == “Placebo”, then <code>cell_index</code> would be
a vector of records in <code>dat$INDEX_</code> that match those
parameters. You can thus obtain the analysis set by filtering
<code>dat</code> via: <code>dat[cell_index %in% INDEX_]</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>strata_val</code>
</td>
<td style="text-align:left;">
A <code>character</code> specifying the stratification level under
evaluation. For example if <code>strat_var =="SEX"</code>, then
<code>strat_val</code> could be either <code>"M"</code> or
<code>"F"</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>treatment_val</code>
</td>
<td style="text-align:left;">
A <code>character</code> specifying the treatment level (or treatment
arm). *Not to be confused with the <code>treatment_refval</code> that
specifies the reference treatment value.
</td>
</tr>
</tbody>
</table>
</div>
<div class="tab-pane" id="stat_by_strata_across_trt" role="tabpanel" aria-labelledby="stat_by_strata_across_trt-tab">

<table class="table table table-bordered table table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Additional arguments passed to by_strata_across_trt functions
</caption>
<thead><tr>
<th style="text-align:left;background-color: lightblue !important;">
Argument Names
</th>
<th style="text-align:left;background-color: lightblue !important;">
Description
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>cell_index</code>
</td>
<td style="text-align:left;">
A <code>vector</code> of indicies specifying which rows in
<code>dat</code> are considered to be part of the analysis for the given
strata level and treatment level under evaluation. For example, if the
current instance of the function was analysis “Number of Events” for
SEX==“M” and TRT01A == “Placebo”, then <code>cell_index</code> would be
a vector of records in <code>dat$INDEX_</code> that match those
parameters. You can thus obtain the analysis set by filtering
<code>dat</code> via: <code>dat[cell_index %in% INDEX_]</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>strata_val</code>
</td>
<td style="text-align:left;">
A <code>character</code> specifying the stratification level under
evaluation. For example if <code>strat_var =="SEX"</code>, then
<code>strat_val</code> could be either <code>"M"</code> or
<code>"F"</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>treatment_refval</code>
</td>
<td style="text-align:left;">
A <code>character</code> specifying the treatment reference level. *Not
to be confused with the <code>treatment_val</code> that specifies the
treatment value for <code>by_strata_by_trt</code> functions
</td>
</tr>
</tbody>
</table>
</div>
<div class="tab-pane" id="stat_by_strata_across_trt-1" role="tabpanel" aria-labelledby="stat_by_strata_across_trt-1-tab">

<table class="table table table-bordered table table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Additional arguments passed to across_strata_across_trt functions
</caption>
<thead><tr>
<th style="text-align:left;background-color: lightblue !important;">
Argument Names
</th>
<th style="text-align:left;background-color: lightblue !important;">
Description
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>strata_val</code>
</td>
<td style="text-align:left;">
A <code>character</code> specifying the stratification level under
evaluation. For example if <code>strat_var =="SEX"</code>, then
<code>strat_val</code> could be either <code>"M"</code> or
<code>"F"</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>treatment_refval</code>
</td>
<td style="text-align:left;">
A <code>character</code> specifying the treatment reference level. *Not
to be confused with the <code>treatment_val</code> that specifies the
treatment value for <code>by_strata_by_trt</code> functions
</td>
</tr>
</tbody>
</table>
<p><br></p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="using-building-blocks">Using building-blocks<a class="anchor" aria-label="anchor" href="#using-building-blocks"></a>
</h3>
<p>When possible, utilize building-block functions when making new
statistical functions. For example, if the new functions requires a 2x2
table, use the <code><a href="../reference/make_two_by_two_.html">make_two_by_two_()</a></code> function instead of
writing a new one.</p>
<p>This also allows you to easily write functions that collapse several
chefStats functions into one function call. For example, on call to
<code><a href="../reference/count_set.html">count_set()</a></code> is the same as one call each to
<code>n_sub()</code>, <code><a href="../reference/n_event.html">n_event()</a></code>,
<code><a href="../reference/n_subj_event.html">n_subj_event()</a></code> and <code><a href="../reference/p_subj_event.html">p_subj_event()</a></code>. The only
rational for combining functions like this is to save compute time, due
to the way chef pipelines are constructed.</p>
<p>Building block function names are always suffixed with an underscore
<code>_</code> to indicate they cannot be called from inside a chef
pipeline. For example, <code><a href="../reference/n_event_.html">n_event_()</a></code> is a building block that
is used to make <code><a href="../reference/n_event.html">n_event()</a></code>, but <code><a href="../reference/n_event_.html">n_event_()</a></code> can
also be use to build other functions, such as <code><a href="../reference/count_set.html">count_set()</a></code>,
because it does not format it’s output for a chef pipeline. Conversely,
<code><a href="../reference/n_event.html">n_event()</a></code> does format the output, so it can be use in a
chef pipeline, but not as a building block.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by MEWP (Matthew Phelps), NOSJ (Nicolai Skov Johnsen), ABIU (Anders Bilgrau), SCQY (scqy), CINO (Christian Haargaard Olsen).</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
